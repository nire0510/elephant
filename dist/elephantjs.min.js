/*! elephant - v0.2.3 - 2014-02-09
* https://github.com/nire0510/elephant
* Copyright (c) 2014 Nir Elbaz; Licensed  */
var Elephant=window.Elephant||function(a,b,c){"use strict";function d(a,d){if(!b.isString(a)||b.isEmpty(a))throw"Object id is illegal";if(d===c&&(d={}),!b.isPlainObject(d))throw"Settings are illegal";return this.id=a.toString(),this.settings=b.extend({},t,d),this.items=[],this}function e(){d.call(this,"Elephant",{})}function f(a,b){d.call(this,a,b)}function g(a,b){d.call(this,a,b)}function h(a,c){this.id=b.uniqueId(),this.timestamps={created:b.now(),sent:null,received:null},this.params=a,this.data=c}function i(a){if("object"!=typeof a)throw"Settings are invalid";for(var c in a)if(a.hasOwnProperty(c))switch(c){case"async":if(b.isBoolean(a[c])===!1)throw'Settings are illegal: "async" must be a boolean';break;case"dataType":if(/xml|script|json|html/.test(a[c])===!1)throw'Settings are illegal: "dataType" must be a either xml, json, html or script';break;case"timeout":if(b.isNumeric(a[c])===!1)throw'Settings are illegal: "timeout" must be a positive integer';break;case"url":if(b.isString(a[c])===!1)throw'Settings are illegal: "url" must be a string';break;case"cache":if(b.isBoolean(a[c])===!1)throw'Settings are illegal: "cache" must be a boolean';break;case"expires":if(b.isNumeric(a[c])===!1)throw'Settings are illegal: "expires" must be a positive integer';break;case"type":if(/GET|POST|PUT|DELETE/.test(a[c])===!1)throw'Settings are illegal: "type" must be a either GET, POST, PUT or DELETE';break;case"process":if(b.isFunction(a[c])===!1)throw'Settings are illegal: "process" callback must be a function'}}function j(a,d){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(d===c&&(d={}),!b.isPlainObject(d))throw"Settings are illegal";i(d);var e=new f(a,d);s.addItem(e)}function k(a){s.removeItem(a)}function l(){s.removeAllItems()}function m(a,d,e){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(!b.isString(d)||b.isEmpty(d))throw"Query id is illegal";if(e===c&&(e={}),!b.isPlainObject(e))throw"Settings are illegal";var f=s.getItem("id",a);if(f===c)throw"Store id could not be found";i(e);var h=new g(d,b.extend({},f.settings,e));f.addItem(h)}function n(a,d){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(!b.isString(d)||b.isEmpty(d))throw"Query id is illegal";var e=s.getItem("id",a);if(e===c)throw"Store id could not be found";e.removeItem(d)}function o(a){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";var d=s.getItem("id",a);if(d===c)throw"Store id could not be found";d.removeAllItems()}function p(a,d,e){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(!b.isString(d)||b.isEmpty(d))throw"Query id is illegal";if(e===c&&(e={}),!b.isPlainObject(e))throw"Settings are illegal";i(e);var f=s.getItem("id",a);if(f===c)throw"Store id could not be found";var g=f.getItem("id",d);if(g===c)throw"Query id could not be found";var j=new h(e.data||{},null);return g.executeQuery(j,b.extend({},g.settings,e))}function q(a,d){var e,f,g=0;switch(arguments.length){case 0:g=s.countItems();break;case 1:if(!b.isString(a))throw"Store id is illegal";if(e=s.getItem("id",a),e===c)throw"Store id could not be found";g=e.countItems();break;case 2:if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(!b.isString(d)||b.isEmpty(d))throw"Query id is illegal";if(e=s.getItem("id",a),e===c)throw"Store id could not be found";if(f=e.getItem("id",d),f===c)throw"Query id could not be found";g=f.countItems()}return g}function r(a,d){if(!b.isString(a)||b.isEmpty(a))throw"Store id is illegal";if(d!==c&&(!b.isString(d)||b.isEmpty(d)))throw"Query id is illegal";var e=s.getItem("id",a);if(e===c)throw"Store id could not be found";if(d!==c){var f=e.getItem("id",d);if(f===c)throw"Query id could not be found";return f.settings}return e.settings}var s,t={expires:3e5,process:null};return d.prototype={addItem:function(a){if(!b.isObject(a))throw"Object is illegal";if(this.itemExists(a)===!1)return this.items.push(a),console.log('Item "%s" added to collection',a.id),!0;throw"Item already exists"},removeAllItems:function(){return this.items=[],0},removeItem:function(a){if(!b.isString(a)||b.isEmpty(a))throw"Object id is illegal";var c=this.getIndex(a);return c>=0?(this.items.splice(c,1),console.log('Object "%s" removed from collection',a),!0):(console.warn('Object "%s" hasn\'t been removed from collection (does it exist?)',a),!1)},countItems:function(){return this.items.length},getItem:function(a,d){var e=null,f=this;if(!b.isString(a)||b.isEmpty(a))throw"Property is illegal";return b.each(f.items,function(b,c){return JSON.stringify(c[a])===JSON.stringify(d)?(e=c,!1):void 0}),e||c},getIndex:function(a){var c=this,d=-1;return b.each(c.items,function(b,c){return c.id===a?(d=b,!1):void 0}),d},itemExists:function(a){var c,d=!1,e=this;if(!b.isObject(a))throw"Object is illegal";return b.each(e.items,function(b,e){c=!0;for(var f in a)if(!e.hasOwnProperty(f)||e[f]!==a[f]){c=!1;break}return c===!0?(d=!0,!1):void 0}),d}},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,f.prototype=Object.create(d.prototype),f.prototype.constructor=f,g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.executeQuery=function(a,d){if(d=b.extend({},this.settings,d),this.settings.cache===!0){var e=this.getItem("params",a.params);if(b.isEmpty(e)===!1){if(b.now()-e.timestamps.received<this.settings.expires){var f=d.success;if(console.log("Serving item from cache..."),f!==c){"function"==typeof f&&(f=[f]);for(var g=0,h=f.length;h>g;g++)"function"==typeof f[g]&&f[g](e.data)}return e.data}this.removeItem(e.id)}}var i=this;return a.timestamps.sent=b.now(),b.ajax(d).done(function(b){"function"==typeof d.process&&(b=d.process(b)),a.data=b,i.addItem(a)}).fail(function(){a=null}).always(function(){null!==a&&(a.timestamps.received=b.now())})},function(){if("function"!=typeof b)throw"jQuery library is required";var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},d=0;b.extend({isBoolean:function(a){return a===!0||a===!1||a&&"object"==typeof a&&"[object Boolean]"===Object.prototype.toString.call(a)||!1},isEmpty:function(a){var c=!0;if(!a)return c;var d=Object.prototype.toString.call(a),e=a.length;return"[object Array]"===d||"[object String]"===d||"[object Arguments]"===d||"[object Object]"===d&&"number"==typeof e&&b.isFunction(a.splice)?!e:b.isObject(a)?"{}"===JSON.stringify(a):c},isObject:function(b){return!(!b||!a[typeof b])},isString:function(a){return"string"==typeof a||a&&"object"==typeof a&&"[object String]"===Object.prototype.toString.call(a)||!1},uniqueId:function(a){var b=++d;return String(a===c?"":a)+b},pluck:function(a,c){var d=[];return b.each(a,function(a,b){b.hasOwnProperty(c)&&d.push(b[c])}),d}}),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),s=new e,console.log("Elephant is ready")}(),{create:j,destroy:k,destroyAll:l,register:m,unregister:n,unregisterAll:o,fetch:p,count:q,settings:r}}(window,window.jQuery);"function"==typeof define&&define.amd&&define.amd.jQuery&&define("elephant",[],function(){"use strict";return Elephant});
